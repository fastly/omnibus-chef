From ea702ecf6d843ed44ecdf1e431efa550b580316a Mon Sep 17 00:00:00 2001
From: Bao Nguyen <bao@fastly.com>
Date: Fri, 1 May 2015 11:33:44 -0700
Subject: [PATCH] fastly only want default route

---
 lib/ohai/plugins/linux/network.rb | 4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

diff --git a/lib/ohai/plugins/linux/network.rb b/lib/ohai/plugins/linux/network.rb
index 3d80a05..2b30989 100644
--- a/lib/ohai/plugins/linux/network.rb
+++ b/lib/ohai/plugins/linux/network.rb
@@ -200,7 +200,9 @@ Ohai.plugin(:Network) do
         #    the routing table source field.
         # 3) and since we're at it, let's populate some :routes attributes
         # (going to do that for both inet and inet6 addresses)
-        so = shell_out("ip -o -f #{family[:name]} route show")
+        # 4) At Fastly we only want to get the default route. Instead of the 2millions
+        # routes that available via the default table.
+        so = shell_out("ip -o -f #{family[:name]} route show #{family[:default_route]}")
         so.stdout.lines do |line|
           line.strip!
           Ohai::Log.debug("Parsing #{line}")
-- 
2.3.2

